<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Singapore Traffic Updates</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Singapore Traffic Updates</h1>

        <div class="expressway-selector">
            <h2>Select an Expressway</h2>
            <button onclick="selectExpressway(this, 'AYE')">AYE</button>
            <button onclick="selectExpressway(this, 'BKE')">BKE</button>
            <button onclick="selectExpressway(this, 'CTE')">CTE</button>
            <button onclick="selectExpressway(this, 'KPE')">KPE</button>
            <button onclick="selectExpressway(this, 'KJE')">KJE</button>
            <button onclick="selectExpressway(this, 'PIE')">PIE</button>
            <button onclick="selectExpressway(this, 'SLE')">SLE</button>
            <button onclick="selectExpressway(this, 'TPE')">TPE</button>
        </div>
        
         <button onclick="fetchTrafficImages()">Fetch Traffic Images</button>
        <div id="loading" style="display: none;">Loading...</div>
        <div id="traffic-result"></div>
    </div>

    <script>
        let selectedExpressway = null;

        function selectExpressway(button, expressway) {
            // Remove 'selected' class from all buttons
            document.querySelectorAll('.expressway-selector button').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add 'selected' class to the clicked button
            button.classList.add('selected');
            
            // Set the selected expressway
            selectedExpressway = expressway;
        }
        
        function fetchTrafficImages() {
            if (!selectedExpressway) {
                document.getElementById('traffic-result').innerHTML = "Please select an expressway first.";
                return;
            }
            
            document.getElementById('loading').style.display = 'block';
            fetch('/download_traffic_images?expressway=${expressway}')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    if (data.status === "success") {
                        // Display success message
                        document.getElementById('traffic-result').innerHTML = "Images downloaded successfully!";

                        // Display the dictionary data
                        const dictionaryData = JSON.stringify(data.data, null, 2); // Pretty-print JSON
                        document.getElementById('traffic-result').innerHTML += `<pre>${dictionaryData}</pre>`;
                    } else {
                        document.getElementById('traffic-result').innerHTML = "Error: " + data.message;
                    }
                })
                .catch(error => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('traffic-result').innerHTML = "An error occurred: " + error;
                });
        }

    </script>
</body>
</html>
